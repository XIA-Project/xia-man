.\" -*- mode: nroff -*-
.\" Generated by 'click-elem2man' from '../elements/ip/ipaddrpairrewriter.hh:8'
.de M
.IR "\\$1" "(\\$2)\\$3"
..
.de RM
.RI "\\$1" "\\$2" "(\\$3)\\$4"
..
.TH "IPADDRPAIRREWRITER" 7click "12/Oct/2017" "Click"
.SH "NAME"
IPAddrPairRewriter \- Click element;
rewrites IP packets' addresses by address pair
.SH "SYNOPSIS"
\fBIPAddrPairRewriter\fR(INPUTSPEC1, ..., INPUTSPECn)

.SH "DESCRIPTION"
Rewrites the source and/or destination addresses on IP packets, along with
their checksums.  \fBIPAddrPairRewriter\fR implements per-address-pair network
address translation, a midpoint between Basic NAT (see 
.M IPAddrRewriter 7 )
and
NAPT (see 
.M IPRewriter 7
and 
.M TCPRewriter 7 ).
.PP
\fBIPAddrPairRewriter\fR maintains a \fImapping table\fR that records how addresses are
rewritten.  On receiving a packet, \fBIPAddrPairRewriter\fR first looks up that
packet in the mapping table by source/destination address pair.  If the table
contains a mapping, then the packet is rewritten according to the mapping and
emitted on the specified output port.  If there was no mapping, the packet is
handled by the INPUTSPEC corresponding to the input port on which the packet
arrived.  (There are as many input ports as INPUTSPECs.)  Most INPUTSPECs
install new mappings, so that future packets from the same address are handled
by the mapping table rather than some INPUTSPEC.  The six forms of INPUTSPEC
handle input packets as follows:
.PP


.IP "\&'drop', 'pass OUTPUT', 'keep FOUTPUT ROUTPUT', 'ELEMENTNAME'" 5
These INPUTSPECs behave like those in 
.M IPRewriter 7 .
.IP "" 5
.IP "\&'pattern SADDR[-SADDR2] DADDR FOUTPUT ROUTPUT'" 5
Creates a mapping according to the given pattern, 'SADDR DADDR'.  Either
pattern field may be a dash '-', in which case the corresponding field is left
unchanged.  For instance, the pattern '1.0.0.1 -' will rewrite input packets'
source address, but leave its destination address unchanged.  SADDR may be a
range 'L-H' or prefix 'ADDR/PFX'; 
.M IPRewriter 7
will choose an unallocated
address in that range, or drop the packet if no address is available.
Normally addresses are chosen randomly within the range.  To allocate
addresses sequentially (which can make testing easier), append a pound sign to
the range, as in '1.0.0.1-1.255.255.254#'.
.IP "" 5
Say a packet with address pair (SA, DA) is received, and the corresponding new
addresses are (SA', DA').  Then two mappings are installed:
.IP "" 5
.nf
\&    (SA, DA) => (SA', DA') [FOUTPUT]
\&    (DA', SA') => (DA, SA) [ROUTPUT]
.fi
.IP "" 5
Thus, the input packet is rewritten and sent to FOUTPUT, and packets from the
reply flow are rewritten to look like part of the original flow and sent to
ROUTPUT.
.IP "" 5

.IP "\&'pattern PATNAME FOUTPUT ROUTPUT'" 5
Behaves like the version in 
.M IPRewriter 7 ,
except that PATNAME must name an
.M IPAddrRewriter 7 -like
pattern.
.IP "" 5
.PP
Input packets must have their IP header annotations set.  \fBIPAddrPairRewriter\fR
changes IP packet data and destination IP address annotations.
.PP
Keyword arguments are:
.PP

.IP "TIMEOUT \fItime\fR" 5
Time out connections every \fItime\fR seconds. Default is 5 minutes.
.IP "" 5
.IP "GUARANTEE \fItime\fR" 5
Preserve each connection mapping for at least \fItime\fR seconds after each
successfully processed packet. Defaults to 5 seconds. Incoming flows are
dropped if the mapping table is full of guaranteed flows.
.IP "" 5
.IP "REAP_INTERVAL \fItime\fR" 5
Reap timed-out connections every \fItime\fR seconds. Default is 15 minutes.
.IP "" 5
.IP "MAPPING_CAPACITY \fIcapacity\fR" 5
Set the maximum number of mappings this rewriter can hold to \fIcapacity\fR.
\fICapacity\fR can either be an integer or the name of another rewriter-like
element, in which case this element will share the other element's capacity.
.IP "" 5
.PP

.SH "ELEMENT HANDLERS"



.IP "\fBtable\fR (read-only)" 5
Returns a human-readable description of the 
.M IPAddrRewriter 7 's
current mapping
table.
.IP "" 5
.IP "\fBtable_size\fR (read-only)" 5
Returns the number of mappings in the table.
.IP "" 5
.IP "\fBpatterns\fR (read-only)" 5
Returns a human-readable description of the patterns associated with this
.M IPAddrRewriter 7 .
.IP "" 5
.PP

.SH "SEE ALSO"
.M IPRewriter 7 ,
.M IPAddrRewriter 7 ,
.M TCPRewriter 7 ,
.M IPRewriterPatterns 7 ,
.M RoundRobinIPMapper 7 ,
.M FTPPortMapper 7 ,
.M ICMPRewriter 7 ,
.M ICMPPingRewriter 7 ,
.M StoreIPAddress 7
.RM ( for 7
.M simple 7
uses)

