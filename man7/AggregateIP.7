.\" -*- mode: nroff -*-
.\" Generated by 'click-elem2man' from '../elements/analysis/aggregateip.hh:8'
.de M
.IR "\\$1" "(\\$2)\\$3"
..
.de RM
.RI "\\$1" "\\$2" "(\\$3)\\$4"
..
.TH "AGGREGATEIP" 7click "12/Oct/2017" "Click"
.SH "NAME"
AggregateIP \- Click element;
sets aggregate annotation based on IP packet field
.SH "SYNOPSIS"
\fBAggregateIP\fR(FIELD, \fIKEYWORDS\fR)

\fBPorts\fR: 1 input, 1-2 outputs
.br
\fBProcessing\fR: agnostic, but output 1 is push
.br
\fBDrivers\fR: userlevel
.br
.SH "DESCRIPTION"
\fBAggregateIP\fR sets the aggregate annotation on every passing packet to a portion
of that packet's IP header, transport header, or payload, depending on the
value of the FIELD argument.
.PP
FIELD can be the name of a header field, like \f(CW"ip tos"\fR, or a general
offset-length specification, like \f(CW"ip[8:2]"\fR. Either form can be modified
with a mask, such as \f(CW"ip src/8"\fR or \f(CW"ip[8:2] & 0x3F0"\fR.
.PP
The aggregate annotation value uses host byte order.
.PP
Valid header field names are \f(CW"ip vers"\fR, \f(CW"ip hl"\fR, \f(CW"ip tos"\fR, \f(CW"ip
dscp"\fR, \f(CW"ip ecn"\fR, \f(CW"ip len"\fR, \f(CW"ip id"\fR, \f(CW"ip off"\fR (the entire
fragmentation offset field), \f(CW"ip rf"\fR, \f(CW"ip df"\fR, \f(CW"ip mf"\fR, \f(CW"ip
fragoff"\fR (just the fragmentation offset value, without the RF, DF, and MF
bits), \f(CW"ip ttl"\fR, \f(CW"ip proto"\fR, \f(CW"ip sum"\fR, \f(CW"ip src"\fR, \f(CW"ip dst"\fR,
\f(CW"udp sport"\fR, \f(CW"udp dport"\fR, \f(CW"udp len"\fR, \f(CW"udp sum"\fR, \f(CW"tcp sport"\fR,
\f(CW"tcp dport"\fR, \f(CW"tcp seq"\fR, \f(CW"tcp ack"\fR, \f(CW"tcp hl"\fR, \f(CW"tcp flags"\fR,
\f(CW"tcp fin"\fR, \f(CW"tcp syn"\fR, \f(CW"tcp rst"\fR, \f(CW"tcp psh"\fR, \f(CW"tcp ackf"\fR, \f(CW"tcp
urg"\fR, \f(CW"tcp win"\fR, \f(CW"tcp sum"\fR, \f(CW"tcp urp"\fR, \f(CW"icmp type"\fR, \f(CW"icmp
code"\fR, and \f(CW"icmp sum"\fR.
.PP
General offset-length specifications begin with \f(CW"ip"\fR, \f(CW"transp"\fR, or
\f(CW"data"\fR, depending on whether the offset should be measured relative to the
IP header, transport header, or payload. (The names \f(CW"tcp"\fR, \f(CW"udp"\fR, and
\f(CW"icmp"\fR act like \f(CW"transp"\fR, but enforce the specified IP protocol.) Next
comes the offset and length, which can take several forms:
.PP


.IP "\f(CW[OFFSET:LENGTH]\fR" 8
The LENGTH bytes starting at byte OFFSET.
.IP "" 8
.IP "\f(CW[OFFSET1-OFFSET2]\fR" 8
From byte OFFSET1 to byte OFFSET2, inclusive.
.IP "" 8
.IP "\f(CW[OFFSET]\fR" 8
The single byte at OFFSET.
.IP "" 8
.IP "\f(CW{OFFSET:LENGTH}\fR, \f(CW{OFFSET1-OFFSET2}\fR, \f(CW{OFFSET}\fR" 8
Similar, but OFFSETs and LENGTHs are measured in bits.
.IP "" 8
.PP
Finally, the mask can equal either `\f(CW/NUM\fR', which means take the top NUM
bits of the field, or `\f(CW& MASK\fR', which means bitwise-and the field with
MASK. (MASK must contain exactly one set of contiguous 1 bits.)
.PP
Keyword arguments are:
.PP

.IP "INCREMENTAL" 8
Boolean. If true, then incrementally update the aggregate annotation: given a
field N bits wide with value V, and an old aggregate annotation of O, the new
aggregate annotation will equal (O * 2^N) + V. Default is false.
.IP "" 8
.IP "UNSHIFT_IP_ADDR" 8
Boolean. If true, and the aggregated field lies within either the IP source or
destination address, then set the aggregate annotation to the masked portion
of that address without shifting. For example, consider a packet with source
address 1.0.0.0, and aggregate field \f(CW"ip src/8"\fR. Without UNSHIFT_IP_ADDR,
the packet will get aggregate annotation 1; with UNSHIFT_IP_ADDR, it will get
aggregate annotation 16777216. Default is false.
.IP "" 8
.PP

.SH "NOTES"
Packets lacking the specified field are pushed onto output 1, or dropped if
there is no output 1. A packet may lack a field because it is too short, it is
a fragment, or it has the wrong protocol. (\f(CW"tcp sport"\fR, for example, is
relevant only for first-fragment TCP packets; \f(CW"data"\fR specifications work
only for first-fragment TCP and UDP.)
.PP
The simple specifications \f(CW"sport"\fR and \f(CW"dport"\fR (no \f(CW"ip"\fR, \f(CW"tcp"\fR, or
\f(CW"udp"\fR) apply to either TCP or UDP packets.
.PP

.SH "EXAMPLES"
Here are a bunch of equivalent ways to ask for the top 8 bits of the IP source
address:
.PP
.nf
\&        AggregateIP(ip src/8)
\&        AggregateIP(ip src & 0xFF000000)
\&        AggregateIP(ip[12])
\&        AggregateIP("ip[12, 1]")        // protect comma
\&        AggregateIP("ip{96, 8}")
\&        AggregateIP(ip{96-103})
.fi
.PP



.SH "ELEMENT HANDLERS"



.IP "\fBheader\fR (read-only)" 5
Returns the header type \fBAggregateIP\fR is using: either "ip", "transp", or
"payload".
.IP "" 5
.IP "\fBbit_offset\fR (read-only)" 5
Returns the offset into the header of the start of the aggregated field, in
bits.
.IP "" 5
.IP "\fBbit_length\fR (read-only)" 5
Returns the length of the aggregated field, in bits.
.IP "" 5
.PP

.SH "SEE ALSO"
.M AggregateLength 7 ,
.M AggregateIPFlows 7 ,
.M AggregateCounter 7 ,
.M AggregatePaint 7

