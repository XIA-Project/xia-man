.\" -*- mode: nroff -*-
.\" Generated by 'click-elem2man' from '../elements/ip/ipfilter.hh:7'
.de M
.IR "\\$1" "(\\$2)\\$3"
..
.de RM
.RI "\\$1" "\\$2" "(\\$3)\\$4"
..
.TH "IPFILTER" 7click "12/Oct/2017" "Click"
.SH "NAME"
IPFilter \- Click element;
filters IP packets by contents
.SH "SYNOPSIS"
\fBIPFilter\fR(ACTION_1 PATTERN_1, ..., ACTION_N PATTERN_N)

\fBPorts\fR: 1 input, any number of outputs
.br
\fBProcessing\fR: push
.br
.SH "DESCRIPTION"
Filters IP packets. \fBIPFilter\fR can have an arbitrary number of filters, which
are ACTION-PATTERN pairs. The ACTIONs describe what to do with packets,
while the PATTERNs are 
.M tcpdump 1 -like
patterns; see 
.M IPClassifier 7 (n)
for a
description of their syntax. Packets are tested against the filters in
order, and are processed according to the ACTION in the first filter that
matched.
.PP
Each ACTION is either a port number, which specifies that the packet should be
sent out on that port; '\f(CWallow\fR', which is equivalent to '\f(CW0\fR'; or '\f(CWdrop\fR'
, which means drop the packet. You can also say '\f(CWdeny\fR' instead of
\&'\f(CWdrop\fR', but see the compatibility note below.
.PP
The \fBIPFilter\fR element has an arbitrary number of outputs. Input packets must
have their IP header annotation set; 
.M CheckIPHeader 7
and 
.M MarkIPHeader 7
do
this.
.PP

.SH "NOTES"
Every \fBIPFilter\fR element has an equivalent corresponding 
.M IPClassifier 7
element
and vice versa. Use the element whose syntax is more convenient for your
needs.
.PP
\fBCompatibility note\fR: '\f(CWdeny\fR' formerly meant '\f(CW1\fR' if the element had at
least two outputs and '\f(CWdrop\fR' if it did not. We decided this was
error-prone; now it just means '\f(CWdrop\fR'. For now, however, '\f(CWdeny\fR' will
print a warning if used on an element with more than one output.
.PP

.SH "EXAMPLES"
This large \fBIPFilter\fR implements the incoming packet filtering rules for the
"Interior router" described on pp691-692 of \fIBuilding Internet Firewalls,
Second Edition\fR (Elizabeth D. Zwicky, Simon Cooper, and D. Brent Chapman,
O'Reilly and Associates, 2000). The captialized words (\f(CWINTERNALNET\fR,
\f(CWBASTION\fR, etc.) are addresses that have been registered with
.M AddressInfo 7 (n).
The rule FTP-7 has a port range that cannot be implemented
with \fBIPFilter\fR.
.PP
.nf
\&  IPFilter(// Spoof-1:
\&           deny src INTERNALNET,
\&           // HTTP-2:
\&           allow src BASTION && dst INTERNALNET
\&              && tcp && src port www && dst port > 1023 && ack,
\&           // Telnet-2:
\&           allow dst INTERNALNET
\&              && tcp && src port 23 && dst port > 1023 && ack,
\&           // SSH-2:
\&           allow dst INTERNALNET && tcp && src port 22 && ack,
\&           // SSH-3:
\&           allow dst INTERNALNET && tcp && dst port 22,
\&           // FTP-2:
\&           allow dst INTERNALNET
\&              && tcp && src port 21 && dst port > 1023 && ack,
\&           // FTP-4:
\&           allow dst INTERNALNET
\&              && tcp && src port > 1023 && dst port > 1023 && ack,
\&           // FTP-6:
\&           allow src BASTION && dst INTERNALNET
\&              && tcp && src port 21 && dst port > 1023 && ack,
\&           // FTP-7 omitted
\&           // FTP-8:
\&           allow src BASTION && dst INTERNALNET
\&              && tcp && src port > 1023 && dst port > 1023,
\&           // SMTP-2:
\&           allow src BASTION && dst INTERNAL_SMTP
\&              && tcp && src port 25 && dst port > 1023 && ack,
\&           // SMTP-3:
\&           allow src BASTION && dst INTERNAL_SMTP
\&              && tcp && src port > 1023 && dst port 25,
\&           // NNTP-2:
\&           allow src NNTP_FEED && dst INTERNAL_NNTP
\&              && tcp && src port 119 && dst port > 1023 && ack,
\&           // NNTP-3:
\&           allow src NNTP_FEED && dst INTERNAL_NNTP
\&              && tcp && src port > 1023 && dst port 119,
\&           // DNS-2:
\&           allow src BASTION && dst INTERNAL_DNS
\&              && udp && src port 53 && dst port 53,
\&           // DNS-4:
\&           allow src BASTION && dst INTERNAL_DNS
\&              && tcp && src port 53 && dst port > 1023 && ack,
\&           // DNS-5:
\&           allow src BASTION && dst INTERNAL_DNS
\&              && tcp && src port > 1023 && dst port 53,
\&           // Default-2:
\&           deny all);
.fi
.PP



.SH "ELEMENT HANDLERS"



.IP "\fBprogram\fR (read-only)" 5
Returns a human-readable definition of the program the \fBIPFilter\fR element
is using to classify packets. At each step in the program, four bytes
of packet data are ANDed with a mask and compared against four bytes of
classifier pattern.
.IP "" 5
.PP

.SH "SEE ALSO"
.M IPClassifier 7 ,
.M Classifier 7 ,
.M CheckIPHeader 7 ,
.M MarkIPHeader 7 ,
.M CheckIPHeader2 7 ,
.M AddressInfo 7 ,
.M tcpdump 1

