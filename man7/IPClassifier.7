.\" -*- mode: nroff -*-
.\" Generated by 'click-elem2man' from '../elements/ip/ipclassifier.hh:6'
.de M
.IR "\\$1" "(\\$2)\\$3"
..
.de RM
.RI "\\$1" "\\$2" "(\\$3)\\$4"
..
.TH "IPCLASSIFIER" 7click "12/Oct/2017" "Click"
.SH "NAME"
IPClassifier \- Click element;
classifies IP packets by contents
.SH "SYNOPSIS"
\fBIPClassifier\fR(PATTERN_1, ..., PATTERN_N)

\fBPorts\fR: 1 input, any number of outputs
.br
\fBProcessing\fR: push
.br
.SH "DESCRIPTION"
Classifies IP packets according to 
.M tcpdump 1 -like
patterns. The
\fBIPClassifier\fR has N outputs, each associated with the corresponding pattern
from the configuration string. The input packets must have their IP header
annotation set; 
.M CheckIPHeader 7
and 
.M MarkIPHeader 7
do this.
.PP
Patterns are built from \fIpattern primitives\fR. The primitives
\fBIPClassifier\fR understands are:
.PP


.IP "\fBip proto PROTO\fR" 8
PROTO is an IP protocol name (see below) or a valid IP protocol number.
Matches packets of the given protocol.
.IP "" 8
.IP "\fB[SRCORDST] host IPADDR\fR" 8
IPADDR is an IP address and SRCORDST is 'src', 'dst', 'src or dst', or 'src
and dst'. (If SRCORDST is missing, 'src or dst' is assumed.) Matches
packets sent to and/or from the given address.
.IP "" 8
.IP "\fB[SRCORDST] net NETADDR\fR" 8
NETADDR is an IP network address (either CIDR-style 'IPADDR/BITS' or
\&'IPADDR mask MASK') and SRCORDST is as above. Matches packets sent to
and/or from the given network.
.IP "" 8
.IP "\fB[SRCORDST] [tcp | udp] port PORT\fR" 8
PORT is a TCP or UDP port name (see below) or number and SRCORDST is as
above. Matches packets sent to and/or from the given TCP or UDP port. If
you leave out 'tcp' or 'udp', then either TCP or UDP is accepted.
.IP "" 8
.IP "\fBip vers VERSION\fR" 8
VERSION is a value between 0 and 15. Matches IP packets with the given
version.
.IP "" 8
.IP "\fBip hl HL\fR" 8
HL is a value between 0 and 15. Matches IP packets with the given header
length.
.IP "" 8
.IP "\fBip id ID\fR" 8
ID is a value between 0 and 65535. Matches IP packets with the given IP ID.
.IP "" 8
.IP "\fBip tos TOS\fR" 8
TOS is a value between 0 and 255. Matches IP packets with the given TOS
value.
.IP "" 8
.IP "\fBip dscp DSCP\fR" 8
DSCP is a value between 0 and 63. Matches IP packets with the given DSCP
value (the upper 6 bits of TOS).
.IP "" 8
.IP "\fBip ect\fR" 8
Matches IP packets with ECN Capable Transport turned on.
.IP "" 8
.IP "\fBip ce\fR" 8
Matches IP packets with ECN Congestion Experienced set.
.IP "" 8
.IP "\fBip ttl TTL\fR" 8
TTL is a value between 0 and 255. Matches IP packets with the given TTL value.
.IP "" 8
.IP "\fBip frag\fR" 8
Matches fragmented IP packets (that is, packets with the more-fragments bit
set and/or a nonzero fragment offset).
.IP "" 8
.IP "\fBip unfrag\fR" 8
Equivalent to 'not ip frag'.
.IP "" 8
.IP "\fBtcp opt TCPOPT\fR" 8
TCPOPT is a TCP option name (see below). Matches TCP packets with the given
option.
.IP "" 8
.IP "\fBtcp win TCPWIN\fR" 8
TCPWIN is a TCP receive window length. Matches TCP packets with the given
window length. Note that window scaling is not applied.
.IP "" 8
.IP "\fBicmp type TYPE\fR" 8
TYPE is a value between 0 and 255 or an ICMP type name (see below). Matches
ICMP packets with the given ICMP type.
.IP "" 8
.IP "\fBip[POS:LEN] VALUE\fR" 8
Matches packets whose IP header field starting at byte position POS, and going
on for LEN bytes, equals VALUE.  You can say \fBip[POS]\fR instead of
\fBip[POS:1]\fR.
.IP "" 8
.IP "\fBtransp[POS:LEN] VALUE\fR" 8
Like \fBip[POS:LEN]\fR, but for transport header fields.  You can also give
particular transport protocols, such as \fBtcp[POS:LEN]\fR.
.IP "" 8
.IP "\fB[SRCORDST] ether host ETH\fR" 8
Matches packets whose source and/or destination Ethernet address matches ETH.
The packet's MAC header annotation must be set.
.IP "" 8
.IP "\fBtrue\fR" 8
Matches every packet.
.IP "" 8
.IP "\fBfalse\fR" 8
Matches no packets.
.IP "" 8
.PP
These primitives can be combined with the connectives 'and', 'or', and 'not'
(synonyms '&&', '||', and '!'), with the ternary operator '?:' (the colon
must be surrounded by spaces!), and with parentheses. For example, '(dst port
www or dst port ssh) and tcp opt syn'.
.PP
All primitives except \fBtcp opt\fR accept an optional OPERATION, '==' or '!=',
which can occur before the actual option.  If no OPERATION is specified, '=='
is assumed.  'src host == 10.0.0.10' matches packets whose source host is
10.0.0.10; 'src host != 10.0.0.10' matches packets whose source host \fIis not\fR
10.0.0.10.  Directives with integer values also support the '<', '>', '<=',
and '>=' operations.
.PP
For \fBport\fR and \fBicmp type\fR directives, 'DIRECTIVE != VALUE' is not the
same as 'not (DIRECTIVE == VALUE)'. For example, 'src tcp port != 5'
matches TCP packets whose source port is not 5, while '!(src tcp port ==
5)' matches non-TCP packets as well. (The 'src tcp port != 5' option is
effectively equivalent to 'tcp and not src tcp port 5'.) Similarly, 'icmp
type != 4' will not match non-ICMP packets. The same goes for the '<', '>',
\&'<=', and '>=' relations.
.PP
Most primitives also accept bitmasks: 'DIRECTIVE & MASK [[OP] VALUE]'.  For
instance, 'src tcp port & 10 == 8'.
.PP
The \fBport\fR, \fBicmp type\fR, and \fBtcp opt\fR directives will only match first
fragments.
.PP
You can omit a lot of this syntax. For example, instead of 'ip proto tcp',
you can just say 'tcp'; and similarly for 'port www' (just say 'www'), 'tcp
opt syn' (just say 'syn'), 'net 10.0.0.0/24' (just say '10.0.0.0/24'), and
\&'ip unfrag' (just say 'unfrag'). You can often eliminate repetitive
qualifiers, too: 'src port 80 or 81' is the same as 'src port 80 or src
port 81'.
.PP
A pattern consisting entirely of "-", "any", or "all" matches every packet.
.PP
The patterns are scanned in order, and the packet is sent to the output
corresponding to the first matching pattern. Thus more specific patterns
should come before less specific ones. You will get a warning if no packet
will ever match a pattern. Usually, this is because an earlier pattern is
more general, or because your pattern is contradictory ('src port www and
src port ftp').
.PP
.SH "NOTES"
Valid IP port names: 'echo', 'discard', 'daytime', 'chargen', 'ftp-data',
\&'ftp', 'ssh', 'telnet', 'smtp', 'domain', 'dns', 'bootps', 'bootpc',
\&'tftp', 'finger', 'www', 'pop3', 'sunrpc', 'auth', 'nntp', 'ntp',
\&'netbios-ns', 'netbios-dgm', 'netbios-ssn', 'snmp', 'snmp-trap', 'irc',
\&'imap3', 'https', 'rip', 'route', 'imaps', 'pop3s'
.PP
Valid IP protocol names: 'icmp', 'igmp', 'ipip', 'tcp', 'udp'
.PP
Valid TCP options: 'syn', 'fin', 'ack', 'rst', 'psh', 'urg'
.PP
Valid ICMP type names: 'echo-reply', 'unreachable', 'sourcequench',
\&'redirect', 'echo', 'routeradvert', 'routersolicit', 'timeexceeded',
\&'parameterproblem', 'timestamp', 'timestamp-reply', 'inforeq',
\&'inforeq-reply', 'maskreq', 'maskreq-reply'
.PP
This element correctly handles IP packets with options.
.PP
\fB[tcp | udp] port\fR, \fBicmp type\fR, \fBtcp opt\fR, and \fBtcp win\fR directives can
only be true on the first fragment of a fragmented packet.
.PP
Every \fBIPClassifier\fR element has an equivalent corresponding 
.M IPFilter 7
element
and vice versa. Use the element whose syntax is more convenient for your
needs.
.PP

.SH "EXAMPLES"
For example,
.PP
.nf
\&  IPClassifier(10.0.0.0/24 and syn,
\&               10.0.0.0/24 and fin ack,
\&               10.0.0.0/24 and tcp,
\&               -);
.fi
.PP
creates an element with four outputs. The first three outputs are for TCP
packets from net 10.0.0.x. SYN packets are sent to output 0, FIN packets
with the ACK bit set to output 1, and all other TCP packets to output 2.
The last output is for all other IP packets, and non-TCP packets from net
10.0.0.x.
.PP
.nf
\&  IPClassifier(dst tcp port 8000 or 8080,
\&               dst tcp port > 1023,
\&               tcp);
.fi
.PP
creates an element with three outputs. The first output is for TCP packets
destined for port 8000 or 8080; the second output is for TCP packets
destined for any other user port (that is, port > 1023); and the third
output is for all other TCP packets. Non-TCP packets are dropped.
.PP


.SH "ELEMENT HANDLERS"



.IP "\fBprogram\fR (read-only)" 5
Returns a human-readable definition of the program the \fBIPClassifier\fR element
is using to classify packets. At each step in the program, four bytes
of packet data are ANDed with a mask and compared against four bytes of
classifier pattern.
.IP "" 5
.IP "\fBpattern0\fR (read/write)" 5
Returns or sets the element's pattern 0. There are as many \f(CWpattern\fR
handlers as there are output ports.
.IP "" 5
.PP

.SH "SEE ALSO"
.M Classifier 7 ,
.M IPFilter 7 ,
.M CheckIPHeader 7 ,
.M MarkIPHeader 7 ,
.M CheckIPHeader2 7 ,
.M tcpdump 1

