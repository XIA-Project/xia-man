.\" -*- mode: nroff -*-
.\" Generated by 'click-elem2man' from '../elements/tcpudp/udprewriter.hh:8'
.de M
.IR "\\$1" "(\\$2)\\$3"
..
.de RM
.RI "\\$1" "\\$2" "(\\$3)\\$4"
..
.TH "UDPREWRITER" 7click "12/Oct/2017" "Click"
.SH "NAME"
UDPRewriter \- Click element;
rewrites TCP/UDP packets' addresses and ports
.SH "SYNOPSIS"
\fBUDPRewriter\fR(INPUTSPEC1, ..., INPUTSPECn [, \fIkeywords\fR])

.SH "DESCRIPTION"
Rewrites the source address, source port, destination address, and/or
destination port on UDP packets, along with their checksums.  IPRewriter
implements the functionality of a network address/port translator
(NAPT).  See also 
.M IPAddrRewriter 7
and 
.M IPAddrPairRewriter 7 ,
which
implement Basic NAT, and 
.M TCPRewriter 7 ,
which implements NAPT plus sequence
number changes for TCP packets.
.PP
Despite its name, \fBUDPRewriter\fR will validly rewrite both TCP and UDP.  However,
in most uses, any given \fBUDPRewriter\fR will see packets of only one protocol.
.PP
\fBUDPRewriter\fR maintains a \fImapping table\fR that records how packets are
rewritten.  The mapping table is indexed by \fIflow identifier\fR, the quadruple
of source address, source port, destination address, and destination port.
Each mapping contains a new flow identifier and an output port.  Input packets
with the indexed flow identifier are rewritten to use the new flow identifier,
then emitted on the output port.  A mapping is written as follows:
.PP
.nf
\&    (SA, SP, DA, DP) => (SA', SP', DA', DP') [OUTPUT]
.fi
.PP
When \fBUDPRewriter\fR receives a packet, it first looks up that packet in the
mapping table by flow identifier.  If the table contains a mapping for the
input packet, then the packet is rewritten according to the mapping and
emitted on the specified output port (but see the CONSTRAIN_FLOW keyword
argument).  If there was no mapping, the packet is handled by the INPUTSPEC
corresponding to the input port on which the packet arrived.  (There are as
many input ports as INPUTSPECs.)  Most INPUTSPECs install new mappings, so
that future packets from the same TCP or UDP flow are handled by the mapping
table rather than some INPUTSPEC.  The six forms of INPUTSPEC handle input
packets as follows:
.PP



.IP "\&'drop' or 'discard'" 5
Discards input packets.
.IP "" 5
.IP "\&'pass OUTPUT'" 5
Sends input packets to output port OUTPUT.  No mappings are installed.
.IP "" 5
.IP "\&'keep FOUTPUT ROUTPUT'" 5
Installs mappings that preserve the input packet's flow ID.  Specifically,
given an input packet with flow ID (SA, SP, DA, DP, PROTO), two mappings are
installed:
.IP "" 5
.nf
\&    (SA, SP, DA, DP, PROTO) => (SA, SP, DA, DP) [FOUTPUT]
\&    (DA, DP, SA, SP, PROTO) => (DA, DP, SA, SP) [ROUTPUT]
.fi
.IP "" 5
Thus, the input packet is emitted on output port FOUTPUT unchanged, and
packets from the reply flow are emitted on output port ROUTPUT unchanged.
.IP "" 5

.IP "\&'pattern SADDR SPORT DADDR DPORT FOUTPUT ROUTPUT'" 5
Creates a mapping according to the given pattern, 'SADDR SPORT DADDR DPORT'.
Any pattern field may be a dash '-', in which case the packet's corresponding
field is left unchanged.  For instance, the pattern '1.0.0.1 20 - -' will
rewrite input packets' source address and port, but leave its destination
address and port unchanged.  SPORT may be a port range 'L-H'; \fBUDPRewriter\fR will
choose a source port in that range so that the resulting mappings don't
conflict with any existing mappings.  The input packet's source port is
preferred, if it is available; otherwise, a random port is chosen.  If no
source port is available, the packet is dropped.  To allocate source ports
sequentially (which can make testing easier), append a pound sign to the
range, as in '1024-65535#'.  To choose a random port rather than preferring
the source, append a '?'.
.IP "" 5
Say a packet with flow ID (SA, SP, DA, DP, PROTO) is received, and the
corresponding new flow ID is (SA', SP', DA', DP').  Then two mappings are
installed:
.IP "" 5
.nf
\&    (SA, SP, DA, DP, PROTO) => (SA', SP', DA', DP') [FOUTPUT]
\&    (DA', DP', SA', SP', PROTO) => (DA, DP, SA, SP) [ROUTPUT]
.fi
.IP "" 5
Thus, the input packet is rewritten and sent to FOUTPUT, and packets from the
reply flow are rewritten to look like part of the original flow and sent to
ROUTPUT.
.IP "" 5

.IP "\&'pattern PATNAME FOUTPUT ROUTPUT'" 5
Like 'pattern' above, but refers to named patterns defined by an
.M IPRewriterPatterns 7
element.
.IP "" 5
.IP "\&'ELEMENTNAME'" 5
Creates mappings according to instructions from the element ELEMENTNAME.  This
element must implement the IPMapper interface.  One example mapper is
.M RoundRobinIPMapper 7 .
.IP "" 5
.PP
\fBUDPRewriter\fR has no mappings when first initialized.
.PP
Input packets must have their IP header annotations set.  Non-TCP and UDP
packets, and second and subsequent fragments, are dropped unless they arrive
on a 'pass' input port.  \fBUDPRewriter\fR changes IP packet data and, optionally,
destination IP address annotations; see the DST_ANNO keyword argument below.
.PP
Keyword arguments are:
.PP

.IP "TIMEOUT \fItime\fR" 5
Time out connections every \fItime\fR seconds. Default is 5 minutes.
.IP "" 5
.IP "STREAMING_TIMEOUT \fItime\fR" 5
Timeout streaming connections every \fItime\fR seconds. A "streaming"
connection, in contrast to an "RPC-like" connection, comprises at least 3
packets and at least one packet in each direction. Default is the TIMEOUT
setting.
.IP "" 5
.IP "GUARANTEE \fItime\fR" 5
Preserve each connection mapping for at least \fItime\fR seconds after each
successfully processed packet. Defaults to 5 seconds. Incoming flows are
dropped if a \fBUDPRewriter\fR's mapping table is full of guaranteed flows.
.IP "" 5
.IP "REAP_INTERVAL \fItime\fR" 5
Reap timed-out connections every \fItime\fR seconds. Default is 15 minutes.
.IP "" 5
.IP "MAPPING_CAPACITY \fIcapacity\fR" 5
Set the maximum number of mappings this rewriter can hold to \fIcapacity\fR.
\fICapacity\fR can either be an integer or the name of another rewriter-like
element, in which case this element will share the other element's capacity.
.IP "" 5
.IP "DST_ANNO" 5
Boolean. If true, then set the destination IP address annotation on passing
packets to the rewritten destination address. Default is true.
.IP "" 5
.PP

.SH "ELEMENT HANDLERS"



.IP "\fBtable\fR (read-only)" 5
Returns a human-readable description of the \fBUDPRewriter\fR's current mapping
table.
.IP "" 5
.PP

.SH "SEE ALSO"
.M TCPRewriter 7 ,
.M IPAddrRewriter 7 ,
.M IPAddrPairRewriter 7 ,
.M IPRewriterPatterns 7 ,
.M RoundRobinIPMapper 7 ,
.M FTPPortMapper 7 ,
.M ICMPRewriter 7 ,
.M ICMPPingRewriter 7

